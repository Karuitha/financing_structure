"0","## Read in the dataset "
"0","my_data <- read_csv(""amelia.csv"") %>% "
"0",""
"0","## Region"
"0","mutate(region = if_else(region == ""Middle East and North Africa"", "
"0","                        "
"0","                        ""North_Africa"", region)) %>% "
"0",""
"0","# Clean the names "
"0","janitor::clean_names() %>% "
"0","  "
"0","# Set up factor variables "
"0","## legal status "
"0","mutate(currentlegalstatus = factor(currentlegalstatus, "
"0","                           levels = c(""NGO"", ""Bank"", ""NBFI"", "
"0","                            ""Credit Union/ Cooperative"", "
"0","                            ""Rural Bank"")), "
"0","      ## Age"
"0","      age = factor(age, levels = c(""New"", ""Young"", ""Mature"")),"
"0","       "
"0","      ## Region "
"0","      region = factor(region, levels = c(""North_Africa"", ""Africa""))) %>% "
"0","  "
"0","      ## Add the financial structure data     "
"0","      left_join(finstr, by = c(""country"", ""year"")) %>% "
"0","  "
"0","      ## Add a binary variable for the legal dummy- NGO vs Others"
"0","      mutate(currentlegaldummy = case_when(currentlegalstatus == ""NGO"" ~ ""NGO"","
"0","                                           "
"0","                                           TRUE ~ ""others""),"
"0","      "
"0","        currentlegaldummy = factor(currentlegaldummy, levels = c(""NGO"", ""others"")),"
"0","        "
"0","        legal_tradition = factor(legal_tradition, "
"0","                                 "
"0","                                 levels = c(""Common"", ""Civil"", ""Other""))) %>% "
"0","  ## Select required variables "
"0","  select(mfiid, mfiname, year, country, currentlegaldummy, currentlegalstatus, "
"0","         "
"0","         percent_of_female_borrowers, operational_self_sufficiency,"
"0","         "
"0","         age, legal_tradition, region.x, asset_structure, "
"0","         "
"0","         assets, kkm, education, pcrdbgdp, stmktcap, prbonds, "
"0","         "
"0","         gdp_growth_annual, donations, donations_assets_ratio, "
"0","         "
"0","         profit_margin, debt_to_equity_ratio, capital_asset_ratio, "
"0","         "
"0","         deposits_to_total_assets) %>% "
"0","  "
"0","          ## Rename region"
"0","         rename(region = region.x) %>% "
"0","  "
"0","  group_by(country) %>% "
"0","  "
"0","  mutate(kkm = replace_na(kkm, median(kkm, na.rm = TRUE)),"
"0","         education = replace_na(education, median(education, na.rm = TRUE)),"
"0","         prbonds = replace_na(prbonds, median(prbonds, na.rm = TRUE)),"
"0","         pcrdbgdp = replace_na(pcrdbgdp, median(pcrdbgdp, na.rm = TRUE)),"
"0","         stmktcap = replace_na(stmktcap, median(stmktcap, na.rm = TRUE))) %>% "
"0","  "
"0","  ungroup() %>% "
"0","  "
"0","  group_by(mfiid) %>% "
"0","  "
"0","  mutate(asset_structure = replace_na(asset_structure, median(asset_structure, na.rm = TRUE)), "
"0","         "
"0","         percent_of_female_borrowers = replace_na(percent_of_female_borrowers, "
"0","                                                  "
"0","                                                  median(percent_of_female_borrowers, na.rm = TRUE)),"
"0","         "
"0","         operational_self_sufficiency = replace_na(operational_self_sufficiency, "
"0","                                                   "
"0","                                                   median(operational_self_sufficiency, na.rm = TRUE)),"
"0","         "
"0","         assets = replace_na(assets, median(assets, na.rm = TRUE)),"
"0","         "
"0","         donations = replace_na(donations, median(donations, na.rm = TRUE)),"
"0","         "
"0","         donations_assets_ratio = replace_na(donations_assets_ratio, "
"0","                                             "
"0","                                  median(donations_assets_ratio, na.rm = TRUE)),"
"0","         "
"0","         profit_margin = replace_na(profit_margin, median(profit_margin, na.rm = TRUE)), "
"0","         "
"0","         capital_asset_ratio = replace_na(capital_asset_ratio, median(capital_asset_ratio, na.rm = TRUE)), "
"0","         "
"0","         debt_to_equity_ratio = replace_na(debt_to_equity_ratio, median(debt_to_equity_ratio, na.rm = TRUE)), "
"0","         "
"0","         deposits_to_total_assets = replace_na(deposits_to_total_assets, median(deposits_to_total_assets, na.rm = TRUE))) %>% "
"0","  "
"0","  ungroup() %>% "
"0","  "
"0","  group_by(region) %>% "
"0","  "
"0","  mutate(education = replace_na(education, median(education, na.rm = TRUE)),"
"0","         "
"0","         kkm = replace_na(kkm, median(kkm, na.rm = TRUE)),"
"0","         "
"0","         gdp_growth_annual = replace_na(gdp_growth_annual, "
"0","                                        "
"0","         median(gdp_growth_annual, na.rm = TRUE))) %>% "
"0","  "
"0","  ungroup() %>% "
"0","  "
"0","  group_by(currentlegalstatus) %>% "
"0","  "
"0","  mutate(assets = replace_na(assets, median(assets, na.rm = TRUE)), "
"0","         "
"0","         percent_of_female_borrowers = replace_na(percent_of_female_borrowers, "
"0","                                                  "
"0","                        median(percent_of_female_borrowers, na.rm = TRUE)),"
"0","         "
"0","         operational_self_sufficiency = replace_na(operational_self_sufficiency, "
"0","                                                   "
"0","                        median(operational_self_sufficiency, na.rm = TRUE)),"
"0","         "
"0","         donations = replace_na(donations, median(donations, na.rm = TRUE)),"
"0","         "
"0","         donations_assets_ratio = replace_na(donations_assets_ratio, "
"0","                                             "
"0","                                  median(donations_assets_ratio, na.rm = TRUE)), "
"0","         "
"0","         profit_margin = replace_na(profit_margin, median(profit_margin, na.rm = TRUE)), "
"0","         "
"0","         capital_asset_ratio = replace_na(capital_asset_ratio, median(capital_asset_ratio, na.rm = TRUE)), "
"0","         "
"0","         debt_to_equity_ratio = replace_na(debt_to_equity_ratio, median(debt_to_equity_ratio, na.rm = TRUE)), "
"0","         "
"0","         deposits_to_total_assets = replace_na(deposits_to_total_assets, median(deposits_to_total_assets, "
"0","                                                                                "
"0","                                                                                na.rm = TRUE))) %>% "
"0","  "
"0","  ungroup() %>% "
"0","  "
"0","  mutate(dummy = if_else(currentlegaldummy == ""NGO"", 0, 1)) %>% "
"0","  "
"0","  mutate(assets = log(assets + 1),"
"0","         "
"0","         pcrdbgdp = log(pcrdbgdp + 1),"
"0","         "
"0","         stmktcap = log(stmktcap + 1),"
"0","         "
"0","         prbonds = log(prbonds + 1)) %>% "
"0","  "
"0","  select(-asset_structure) %>% "
"0","  "
"0","  add_count(mfiid, name = ""count"") %>% "
"0","  "
"0","  mutate(currentlegalstatus = fct_recode(currentlegalstatus, Coop = ""Credit Union/ Cooperative"")) %>% "
"0","  "
"0","  mutate(finsoc = case_when(operational_self_sufficiency >= 1 & percent_of_female_borrowers > 0.5 ~ ""SS"","
"0","                            "
"0","                            operational_self_sufficiency > 1 & percent_of_female_borrowers < 0.5 ~ ""SF"", "
"0","                            "
"0","                            operational_self_sufficiency < 1 & percent_of_female_borrowers >= 0.5 ~ ""FS"","
"0","                            "
"0","                            TRUE ~ ""FF"")) %>% "
"0","  "
"0","mutate(finsoc = factor(finsoc, levels = c(""FF"", ""SF"", ""FS"", ""SS""))) %>% "
"0","  "
"0","## replace negative donations with zero"
"0","mutate(donations = case_when(donations <= 0 ~ 1,"
"0","                             TRUE ~ donations + 1)) %>% "
"0","  "
"0","mutate(stmktcap = if_else(stmktcap == 0, 1, stmktcap + 1)) %>% "
"0","  "
"0","mutate(donations_assets_ratio = case_when(donations_assets_ratio <= 0 ~ 1,"
"0","                             TRUE ~ donations_assets_ratio + 1)) %>% "
"0","  "
"0","mutate(profit_margin = case_when(profit_margin < -50 ~ 51,"
"0","                                 TRUE ~ profit_margin + 51))"
"0","## Write a csv for the data"
"0","my_data %>% write.csv(., ""data.csv"")"
"0",""
"0","## Visualize missing data"
"0","#md.pattern(data)"
"0","## Amelia::missmap(data)"
"0",""
"0","## MFIs with three (3) or more years of data"
"0","data3 <- my_data %>% "
"0","  "
"0","  group_by(mfiid) %>% "
"0","  "
"0","  filter(n() > 3)"
"0","  "
"0","data3 %>% write.csv(., ""data3.csv"")"
"0",""
"0","## MFIs with three (3) or more years of data"
"0","data5 <- my_data %>% "
"0","  "
"0","  group_by(mfiid) %>% "
"0","  "
"0","  filter(n() > 5)  "
"0","  "
"0","data5 %>% write.csv(., ""data5.csv"")"
